<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="es" xml:lang="es"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>El Dibu de la vida – Estadística Bayesiana</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../trabajos_practicos/03_tp3.html" rel="next">
<link href="../trabajos_practicos/01_tp1.html" rel="prev">
<link href="../utils/imgs/favicon.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "Sin resultados",
    "search-matching-documents-text": "documentos encontrados",
    "search-copy-link-title": "Copiar el enlace en la búsqueda",
    "search-hide-matches-text": "Ocultar resultados adicionales",
    "search-more-match-text": "resultado adicional en este documento",
    "search-more-matches-text": "resultados adicionales en este documento",
    "search-clear-button-title": "Borrar",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancelar",
    "search-submit-button-title": "Enviar",
    "search-label": "Buscar"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Estadística Bayesiana</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Buscar"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Navegación de palanca" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../info/programa.html"> 
<span class="menu-text">Información</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../teoria/u1_teoria_01.html"> 
<span class="menu-text">Teoría</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../practica/practica_00.html"> 
<span class="menu-text">Práctica</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="../trabajos_practicos/descripcion.html" aria-current="page"> 
<span class="menu-text">Trabajos Prácticos</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../recursos/codigo/index.html"> 
<span class="menu-text">Recursos</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/estadisticaunr/estadistica-bayesiana"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Alternar barra lateral" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../trabajos_practicos/02_tp2.html">TP 2: El Dibu de la vida</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Alternar barra lateral" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto"><div class="quarto-sidebar-header"><div class="sidebar-header-item">
<p>Trabajos Prácticos</p>
</div></div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../trabajos_practicos/descripcion.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Generalidades</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../trabajos_practicos/01_tp1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">TP 1: ¿La gloria es el dinero?</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../trabajos_practicos/02_tp2.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">TP 2: El Dibu de la vida</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../trabajos_practicos/03_tp3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">TP 3: Una masacre estadística</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../trabajos_practicos/04_tp_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">TP Final</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
    <div class="quarto-alternate-formats"><h2>Otros formatos</h2><ul><li><a href="02_tp2.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li></ul></div></div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">El Dibu de la vida</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="introducción" class="level2">
<h2 class="anchored" data-anchor-id="introducción">Introducción</h2>
<p>El ozono (O₃) es un gas que se encuentra tanto en la atmósfera como en la superficie terrestre y cuya molécula está formada por tres átomos de oxígeno. Seguramente, lo han escuchado nombrar por su papel en la capa de ozono, una región de la estratófera que se encuentra entre unos 15 y 30 kilómetros sobre la superficie terrestre, donde se concentra este gas y filtra los rayos ultravioletas del sol.</p>
<p>La capa de ozono permite que exista la vida en la Tierra tal como la conocemos y que una escapada de verano a la isla no termine siendo solo un viaje de ida. En otras palabras, la capa de ozono es como un Dibu Martínez de la vida: evita que el sol nos clave un golazo de radiación y nos deje, literalmente, fritos.</p>
<p>Pero no todo lo que brilla es oro. A nivel del suelo, el ozono se convierte en un contaminante atmosférico dañino tanto para la salud humana como para el medio ambiente. Puede deteriorar la función pulmonar, desencadenar ataques de asma, causar irritación en los ojos, la nariz y la garganta, e incluso dañar la vegetación. Entonces, ¿todo mal con el ozono?</p>
<p>Quien se planteó esa pregunta fue Brian Tarkington, del <em>California Primate Research Center</em> de la Universidad de California en Davis. Preocupado por la presencia de ozono en el <em>smog</em> californiano y las posibles consecuencias en la salud humana, decidió llevar a cabo un estudio para evaluar el efecto del ozono en el crecimiento de ratas. Tomó un grupo de 46 ratas jóvenes y de la misma edad, las pesó, las dividió aleatoriamente en 2 grupos de igual tamaño y las dejó en 2 ambientes distintos, el primero rico en ozono y el segundo libre del mismo. Luego de 7 días las pesó nuevamente y registró la diferencia entre los pesos.</p>
<p>El archivo <code>tarkington.csv</code> contiene, para cada una de las ratas, el diferencial de peso en gramos y el grupo al que pertenece. Interesa conocer si la exposición prolongada a un ambiente contaminado con ozono se asocia a un deterioro en el desarrollo de las ratas, es decir, a un menor incremento de peso.</p>
</section>
<section id="modelización-estadística" class="level2">
<h2 class="anchored" data-anchor-id="modelización-estadística">Modelización estadística</h2>
<p>La Estadística ofrece una amplia variedad de técnicas para dar respuesta a la inquietud de Tarkington. En el contexto de esta materia, naturalmente, abordaremos el problema mediante el uso modelos bayesianos.</p>
<p>Y dado que el entusiasmo en esta materia es lo que sobra, aprovecharemos la oportunidad para utilizar no uno, sino dos modelos, sutilmente distintos. Esto nos permitirá no solo evaluar el efecto del ozono en el crecimiento de las ratas, sino también profundizar en esos pequeños detalles que hacen que la inferencia estadística sea tan interesante.</p>
<section id="modelo-normal" class="level3">
<h3 class="anchored" data-anchor-id="modelo-normal">Modelo normal</h3>
<p>El primer modelo que proponemos es el clásico caballito de batalla de innumerables análisis estadísticos: el viejo y confiable modelo normal. Aquí, el cambio en el peso de las ratas en cada grupo se modela mediante una distribución normal, permitiendo medias y varianzas específicas para cada grupo.</p>
<p><span class="math display">\[
\begin{aligned}
Y_{O, i} &amp;\sim \text{Normal}(\mu_O, \sigma_O^2) &amp; i = 1, \dots, N_O \\
Y_{C, j} &amp;\sim \text{Normal}(\mu_C, \sigma_C^2) &amp; j = 1, \dots, N_C \\
\mu_O, \mu_C &amp;\sim \text{Normal}(0, 5^2) \\
\sigma_O, \sigma_C &amp; \sim \text{Gamma}(\alpha=6, \beta=2)
\end{aligned}
\]</span> donde <span class="math inline">\(Y_{O, i}\)</span> representa el cambio en el peso de la <span class="math inline">\(i\)</span>-ésima rata en el grupo expuesto al ozono e <span class="math inline">\(Y_{C, j}\)</span> representa el cambio en el peso de la <span class="math inline">\(j\)</span>-ésima rata en el grupo control.</p>
</section>
<section id="modelo-t-de-student" class="level3">
<h3 class="anchored" data-anchor-id="modelo-t-de-student">Modelo T de Student</h3>
<p>El segundo modelo se parece demasiado al primero. La única —y, en principio, sutil— diferencia es que, en lugar de modelar la variable respuesta en cada grupo con una distribución normal, utilizamos una T de Student con 3 grados de libertad.</p>
<p><span class="math display">\[
\begin{aligned}
Y_{O, i} &amp;\sim \text{Student-T}(\mu_O, \sigma_O^2, \nu=3) &amp; i = 1, \dots, N_O \\
Y_{C, i} &amp;\sim \text{Student-T}(\mu_C, \sigma_C^2, \nu=3) &amp; j = 1, \dots, N_C \\
\mu_O, \mu_C &amp;\sim \text{Normal}(0, 5^2) \\
\sigma_O, \sigma_C &amp; \sim \text{Gamma}(\alpha=6, \beta=2)
\end{aligned}
\]</span></p>
</section>
</section>
<section id="un-deep-dive-bien-profundo-en-metropolis-hastings" class="level2">
<h2 class="anchored" data-anchor-id="un-deep-dive-bien-profundo-en-metropolis-hastings">Un <em>deep dive</em> bien profundo en Metropolis-Hastings</h2>
<p>Además de brindarle una respuesta al pobre de Brian Tarkington, que hace décadas que espera que alguien le ayude a resolver su problema, el objetivo principal de este trabajo práctico es profundizar en el uso de Metropolis-Hastings (MH) como algoritmo de inferencia bayesiana.</p>
<p>El algoritmo de Metropolis-Hastings permite generar muestras (pseudo-)aleatorias a partir de una distribución de probabilidad <span class="math inline">\(P\)</span> que no necesariamente pertence a una familia de distribuciones conocida. El único requisito es que se pueda evaluar la función de densidad (o de masa de probabilidad) <span class="math inline">\(p^*(\boldsymbol{\theta})\)</span> en cualquier valor de <span class="math inline">\(\boldsymbol{\theta}\)</span>, incluso cuando <span class="math inline">\(p^*(\boldsymbol{\theta})\)</span> sea impropia (es decir, incluso aunque sea desconocida la constante de normalización que hace que la integral en el soporte de la función sea igual a uno).</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Algoritmo de Metropolis-Hastings
</div>
</div>
<div class="callout-body-container callout-body">
<p>Se desea generar una muestra de valores <span class="math inline">\(\{y^{(1)}, y^{(2)}, \cdots, y^{(n)} \}\)</span> a partir de una distribución de probabilidad <span class="math inline">\(P\)</span> con función de densidad <span class="math inline">\(p\)</span>.</p>
<ol type="1">
<li><p>Seleccionar un punto inicial <span class="math inline">\(y^{(1)}\)</span>.</p></li>
<li><p>Para cada <span class="math inline">\(t\in \{1, \cdots, n\}\)</span>, repetir:</p></li>
</ol>
<ol type="i">
<li><p><strong>Realizar propuesta</strong><br>
Obtener un valor aleatorio <span class="math inline">\(y'\)</span> de una variable <span class="math inline">\(Y'\)</span> cuya distribución está dada por la distribución de propuesta <span class="math inline">\(Q\)</span>, centrada en el valor de la última muestra obtenida: <span class="math display">\[
    Y' \sim Q(y^{(t)})
    \]</span></p></li>
<li><p><strong>Calcular la probabilidad de aceptación</strong><br>
Calcular el cociente entre la función de densidad en el punto propuesto y en el punto actual, ponderando por la densidad de la distribución de propuesta. La probabilidad de aceptación es igual a este cociente si es menor a 1, caso contrario es igual a 1. <span class="math display">\[
    \alpha = \min \left\{ 1, \frac{p(y')q(y^{(t)} \mid y')}{p(y^{(t)})q(y' \mid y^{(t)})} \right\}
    \]</span></p></li>
<li><p><strong>Seleccionar el nuevo valor</strong><br>
Generar un valor aleatorio <span class="math inline">\(u\)</span> de una distribución <span class="math inline">\(\mathcal{U}(0, 1)\)</span> y determinar <span class="math inline">\(y^{(t + 1)}\)</span> de la siguiente manera: <span class="math display">\[
    y^{(t + 1)} = \left\{
    \begin{array}{ll}
    y' &amp; \text{si} \quad u \le \alpha \\
    y^{(t)} &amp; \text{si} \quad u &gt; \alpha
    \end{array}\right.
    \]</span></p></li>
</ol>
</div>
</div>
<section id="metropolis-hastings-en-espacios-paramétricos-acotados" class="level3">
<h3 class="anchored" data-anchor-id="metropolis-hastings-en-espacios-paramétricos-acotados">Metropolis-Hastings en espacios paramétricos acotados</h3>
<p>La distribución normal suele ser una elección conveniente a la hora de proponer saltos, pero presenta desventajas cuando el espacio paramétrico es acotado: inevitablemente, algunas propuestas caerán fuera del dominio y rechazaremos más que de costumbre.</p>
<p>Para abordar este problema, existen dos estrategias principales. Una opción es utilizar distribuciones cuyo soporte coincida con el espacio objetivo. Sin embargo, encontrar parametrizaciones basadas en la media para todas ellas no es trivial.</p>
<p>La otra alternativa, más general, consiste en aplicar una transformación de variables para trabajar en un espacio no acotado, permitiendo así seguir utilizando una distribución de propuesta normal. Esta estrategia requiere conocer la densidad objetivo en el nuevo espacio, lo que implica calcular el determinante del jacobiano de la transformación. A su favor, muchas de las transformaciones más utilizadas permiten un cálculo sencillo, y este proceso puede automatizarse con herramientas de diferenciación automática existentes.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Transformación de variables aleatorias
</div>
</div>
<div class="callout-body-container callout-body">
<p>Sean <span class="math inline">\(X\)</span> e <span class="math inline">\(Y = g(X)\)</span> variables aleatorias continuas, donde <span class="math inline">\(g\)</span> es una función uno a uno y <span class="math inline">\(X\)</span> tiene función de densidad <span class="math inline">\(f_X(x)\)</span> conocida. Luego, la función de densidad de <span class="math inline">\(Y\)</span> es: <span class="math display">\[
f_Y(y) = f_X\left(g^{-1}(y)\right) \left\lvert \frac{d}{dy}g^{-1}(y) \right\rvert
\]</span></p>
<p>donde <span class="math inline">\(\left\lvert \frac{d}{dy}g^{-1}(y) \right\rvert\)</span> es el determinante del jacobiano de la transformación. Por ejemplo, en el caso de la función <span class="math inline">\(g(u) = \text{logit}(u)\)</span>, se tiene: <span class="math display">\[
\begin{aligned}
g : (0, 1) \to \mathbb{R} &amp; \quad g(u)= \text{logit}(u) = \log\left(\frac{u}{1 - u}\right) \\
g^{-1} : \mathbb{R} \to (0, 1) &amp; \quad g(v)= \text{expit}(v) =  \frac{1}{1 + \exp(-v)}
\end{aligned}
\]</span></p>
<p>y luego, utilizando <span class="math inline">\(X\)</span> e <span class="math inline">\(Y\)</span> definidas al principio: <span class="math display">\[
f_Y(y) = f_X(\text{expit}(y)) \cdot \text{expit}(y) \cdot ( 1 - \text{expit}(y))
\]</span></p>
</div>
</div>
</section>
<section id="metropolis-hastings-en-escala-logarítmica" class="level3">
<h3 class="anchored" data-anchor-id="metropolis-hastings-en-escala-logarítmica">Metropolis-Hastings en escala logarítmica</h3>
<p>Sin importar cuán moderna y potente sea nuestra computadora, siempre tendremos que lidiar con el talón de Aquiles del cálculo computacional: los problemas de subdesbordamiento y sobredesbordamiento (conocidos como <em>underflow</em> y <em>overflow</em> en inglés). Por ejemplo, si intentamos multiplicar 100 números del orden de <code>0.0001</code> en R, la computadora podría interpretar el resultado como 0, aunque matemáticamente esto no sea cierto.</p>
<p>El <em>underflow</em> es un problema frecuente en el cómputo estadístico. Un caso típico es el que se da al evaluar funciones de verosimilitud, donde se multiplican densidades correspondientes a cada observación. Dado que estas densidades suelen ser valores muy pequeños, es común enfrentarse a un problema de subdesbordamiento. Este riesgo aumenta con la cantidad de observaciones y el número de dimensiones de la distribución objetivo.</p>
<p>El problema se agrava al utilizar algoritmos como Metropolis-Hastings, ya que la densidad objetivo se evalúa miles de veces en diferentes puntos del espacio paramétrico. Además, en inferencia bayesiana, esta función suele involucrar una función de verosimilitud, que puede implicar una multiplicación de gran cantidad de números pequeños, lo que incrementa aún más las chances de que el cómputo resulte en un <em>underflow</em>.</p>
<p>Si nuestro algoritmo de muestreo encuentra un problema de <em>underflow</em>, pueden ocurrir dos situaciones:</p>
<ul>
<li>Se genera un error que detiene la ejecución del programa.</li>
<li>Se ignora la propuesta problemática y se realiza una nueva, pero nuestro programa ya no sigue la cadena de Markov deseada.</li>
</ul>
<p>Entonces, ¿cómo solucionamos este problema? La respuesta es sencilla: realizar todos los cálculos en escala logarítmica. Las multiplicaciones se vuelven sumas y el cómputo se estabiliza.</p>
<div id="lst-mh-log" class="listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-mh-log-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listado&nbsp;1: Implementación del algoritmo de Metropolis-Hastings en escala logarítmica.
</figcaption>
<div aria-describedby="lst-mh-log-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode" id="annotated-cell-1"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-1-1"><a href="#annotated-cell-1-1"></a>metropolis_hastings_log <span class="ot">&lt;-</span> <span class="cf">function</span>(logp, x, n, <span class="at">sigma =</span> <span class="cn">NULL</span>) {</span>
<span id="annotated-cell-1-2"><a href="#annotated-cell-1-2"></a>  <span class="co"># Algortimo de Metropolis Hastings en escala logarítmica</span></span>
<span id="annotated-cell-1-3"><a href="#annotated-cell-1-3"></a>  <span class="co">#</span></span>
<span id="annotated-cell-1-4"><a href="#annotated-cell-1-4"></a>  <span class="co"># Parámetros</span></span>
<span id="annotated-cell-1-5"><a href="#annotated-cell-1-5"></a>  <span class="co">#  ------------------------------------------------------------------------</span></span>
<span id="annotated-cell-1-6"><a href="#annotated-cell-1-6"></a>  <span class="co"># | logp     | Función de densidad objetivo, normalizada o sin normalizar, |</span></span>
<span id="annotated-cell-1-7"><a href="#annotated-cell-1-7"></a>  <span class="co"># |          | en escala logarítmica.                                      |</span></span>
<span id="annotated-cell-1-8"><a href="#annotated-cell-1-8"></a>  <span class="co"># | x        | Posición inicial del algoritmo.                             |</span></span>
<span id="annotated-cell-1-9"><a href="#annotated-cell-1-9"></a>  <span class="co"># | n        | Cantidad de muestras a obtener.                             |</span></span>
<span id="annotated-cell-1-10"><a href="#annotated-cell-1-10"></a>  <span class="co"># | sigma    | Matriz de varianzas y covarianzas para la distribución de   |</span></span>
<span id="annotated-cell-1-11"><a href="#annotated-cell-1-11"></a>  <span class="co"># |          | propuesta. Por defecto, es NULL y usa la matriz identidad.  |</span></span>
<span id="annotated-cell-1-12"><a href="#annotated-cell-1-12"></a>  <span class="co">#  ------------------------------------------------------------------------</span></span>
<span id="annotated-cell-1-13"><a href="#annotated-cell-1-13"></a>  <span class="co">#</span></span>
<span id="annotated-cell-1-14"><a href="#annotated-cell-1-14"></a>  <span class="co"># Salida</span></span>
<span id="annotated-cell-1-15"><a href="#annotated-cell-1-15"></a>  <span class="co">#  ------------------------------------------------------------------------</span></span>
<span id="annotated-cell-1-16"><a href="#annotated-cell-1-16"></a>  <span class="co"># | muestras | Matriz con las muestras obtenidas.                          |</span></span>
<span id="annotated-cell-1-17"><a href="#annotated-cell-1-17"></a>  <span class="co">#  ------------------------------------------------------------------------</span></span>
<span id="annotated-cell-1-18"><a href="#annotated-cell-1-18"></a></span>
<span id="annotated-cell-1-19"><a href="#annotated-cell-1-19"></a>  <span class="co"># Obtener dimensionalidad de la distribución objetivo a partir del punto inicial</span></span>
<span id="annotated-cell-1-20"><a href="#annotated-cell-1-20"></a>  p <span class="ot">&lt;-</span> <span class="fu">length</span>(x)</span>
<span id="annotated-cell-1-21"><a href="#annotated-cell-1-21"></a></span>
<span id="annotated-cell-1-22"><a href="#annotated-cell-1-22"></a>  <span class="co"># Inicializar matriz donde se guardan las muestras</span></span>
<span id="annotated-cell-1-23"><a href="#annotated-cell-1-23"></a>  muestras <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> n, <span class="at">ncol =</span> p)</span>
<span id="annotated-cell-1-24"><a href="#annotated-cell-1-24"></a></span>
<span id="annotated-cell-1-25"><a href="#annotated-cell-1-25"></a>  <span class="co"># Usar matriz diagonal unitaria para la distribución de propuesta cuando no se especifica</span></span>
<span id="annotated-cell-1-26"><a href="#annotated-cell-1-26"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(sigma)) {</span>
<span id="annotated-cell-1-27"><a href="#annotated-cell-1-27"></a>    sigma <span class="ot">&lt;-</span> <span class="fu">diag</span>(p)</span>
<span id="annotated-cell-1-28"><a href="#annotated-cell-1-28"></a>  }</span>
<span id="annotated-cell-1-29"><a href="#annotated-cell-1-29"></a></span>
<span id="annotated-cell-1-30"><a href="#annotated-cell-1-30"></a>  <span class="co"># Almacenar el punto inicial en la matriz de muestras</span></span>
<span id="annotated-cell-1-31"><a href="#annotated-cell-1-31"></a>  muestras[<span class="dv">1</span>, ] <span class="ot">&lt;-</span> x</span>
<span id="annotated-cell-1-32"><a href="#annotated-cell-1-32"></a></span>
<span id="annotated-cell-1-33"><a href="#annotated-cell-1-33"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(n <span class="sc">-</span> <span class="dv">1</span>)) {</span>
<span id="annotated-cell-1-34"><a href="#annotated-cell-1-34"></a>    <span class="co"># Obtener el valor de la muestra actual</span></span>
<span id="annotated-cell-1-35"><a href="#annotated-cell-1-35"></a>    muestra_actual <span class="ot">&lt;-</span> muestras[i, ]</span>
<span id="annotated-cell-1-36"><a href="#annotated-cell-1-36"></a></span>
<span id="annotated-cell-1-37"><a href="#annotated-cell-1-37"></a>    <span class="co"># Proponer un nuevo valor</span></span>
<span id="annotated-cell-1-38"><a href="#annotated-cell-1-38"></a>    muestra_propuesta <span class="ot">&lt;-</span> mvtnorm<span class="sc">::</span><span class="fu">rmvnorm</span>(<span class="dv">1</span>, <span class="at">mean =</span> muestra_actual, <span class="at">sigma =</span> sigma)</span>
<span id="annotated-cell-1-39"><a href="#annotated-cell-1-39"></a></span>
<span id="annotated-cell-1-40"><a href="#annotated-cell-1-40"></a>    <span class="co"># Evaluar la log densidad en el valor actual y en el propuesto</span></span>
<span id="annotated-cell-1-41"><a href="#annotated-cell-1-41"></a>    logp_propuesta <span class="ot">&lt;-</span> <span class="fu">logp</span>(muestra_propuesta)</span>
<span id="annotated-cell-1-42"><a href="#annotated-cell-1-42"></a>    logp_actual <span class="ot">&lt;-</span> <span class="fu">logp</span>(muestra_actual)</span>
<span id="annotated-cell-1-43"><a href="#annotated-cell-1-43"></a></span>
<span id="annotated-cell-1-44"><a href="#annotated-cell-1-44"></a>    <span class="co"># Log densidad al pasar de muestra_propuesta a muestra_actual y viceversa</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-1" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-1-45" class="code-annotation-target"><a href="#annotated-cell-1-45"></a>    logq_actual <span class="ot">&lt;-</span> mvtnorm<span class="sc">::</span><span class="fu">dmvnorm</span>(</span>
<span id="annotated-cell-1-46"><a href="#annotated-cell-1-46"></a>      muestra_actual, <span class="at">mean =</span> muestra_propuesta, <span class="at">sigma =</span> sigma, <span class="at">log =</span> <span class="cn">TRUE</span></span>
<span id="annotated-cell-1-47"><a href="#annotated-cell-1-47"></a>    )</span>
<span id="annotated-cell-1-48"><a href="#annotated-cell-1-48"></a>    logq_propuesta <span class="ot">&lt;-</span> mvtnorm<span class="sc">::</span><span class="fu">dmvnorm</span>(</span>
<span id="annotated-cell-1-49"><a href="#annotated-cell-1-49"></a>      muestra_propuesta, <span class="at">mean =</span> muestra_actual, <span class="at">sigma =</span> sigma, <span class="at">log =</span> <span class="cn">TRUE</span></span>
<span id="annotated-cell-1-50"><a href="#annotated-cell-1-50"></a>    )</span>
<span id="annotated-cell-1-51"><a href="#annotated-cell-1-51"></a></span>
<span id="annotated-cell-1-52"><a href="#annotated-cell-1-52"></a>    <span class="co"># Calcular log probabilidad de aceptación</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-1" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-1-53" class="code-annotation-target"><a href="#annotated-cell-1-53"></a>    log_alpha <span class="ot">&lt;-</span> ...</span>
<span id="annotated-cell-1-54"><a href="#annotated-cell-1-54"></a></span>
<span id="annotated-cell-1-55"><a href="#annotated-cell-1-55"></a>    <span class="co"># Simular aceptación o rechazo</span></span>
<span id="annotated-cell-1-56"><a href="#annotated-cell-1-56"></a>    log_u <span class="ot">&lt;-</span> <span class="fu">log</span>(<span class="fu">runif</span>(<span class="dv">1</span>))</span>
<span id="annotated-cell-1-57"><a href="#annotated-cell-1-57"></a></span>
<span id="annotated-cell-1-58"><a href="#annotated-cell-1-58"></a>    aceptar <span class="ot">&lt;-</span> log_u <span class="sc">&lt;</span> log_alpha</span>
<span id="annotated-cell-1-59"><a href="#annotated-cell-1-59"></a></span>
<span id="annotated-cell-1-60"><a href="#annotated-cell-1-60"></a>    <span class="co"># Determinar siguiente paso en base al criterio de selección</span></span>
<span id="annotated-cell-1-61"><a href="#annotated-cell-1-61"></a>    <span class="cf">if</span> (aceptar) {</span>
<span id="annotated-cell-1-62"><a href="#annotated-cell-1-62"></a>      muestras[i <span class="sc">+</span> <span class="dv">1</span>, ] <span class="ot">&lt;-</span> muestra_propuesta</span>
<span id="annotated-cell-1-63"><a href="#annotated-cell-1-63"></a>    } <span class="cf">else</span> {</span>
<span id="annotated-cell-1-64"><a href="#annotated-cell-1-64"></a>      muestras[i <span class="sc">+</span> <span class="dv">1</span>, ] <span class="ot">&lt;-</span> muestra_actual</span>
<span id="annotated-cell-1-65"><a href="#annotated-cell-1-65"></a>    }</span>
<span id="annotated-cell-1-66"><a href="#annotated-cell-1-66"></a>  }</span>
<span id="annotated-cell-1-67"><a href="#annotated-cell-1-67"></a>  <span class="co"># Convertir 'muestras' a vector si se trata de una distrbución univariada</span></span>
<span id="annotated-cell-1-68"><a href="#annotated-cell-1-68"></a>  <span class="cf">if</span> (p <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="annotated-cell-1-69"><a href="#annotated-cell-1-69"></a>    muestras <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(muestras)</span>
<span id="annotated-cell-1-70"><a href="#annotated-cell-1-70"></a>  }</span>
<span id="annotated-cell-1-71"><a href="#annotated-cell-1-71"></a></span>
<span id="annotated-cell-1-72"><a href="#annotated-cell-1-72"></a>  <span class="fu">return</span>(muestras)</span>
<span id="annotated-cell-1-73"><a href="#annotated-cell-1-73"></a>}</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-1" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-1" data-code-lines="45,46,47,48,49,50" data-code-annotation="1">¿Es necesario este paso?</span>
</dd>
<dt data-target-cell="annotated-cell-1" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-1" data-code-lines="53" data-code-annotation="2">¿Cómo se calcula la log probabilidad de aceptación?</span>
</dd>
</dl>
</div>
</figure>
</div>
</section>
</section>
<section id="ahora-sí-cerebro-a-la-obra" class="level2">
<h2 class="anchored" data-anchor-id="ahora-sí-cerebro-a-la-obra">Ahora sí, cerebro a la obra</h2>
<p>La función <code>metropolis_hastings_log()</code> es una herramienta poderosa que, en teoría, permite obtener muestras de cualquier distribución <em>a posteriori</em> que se pueda implementar en R en escala logarítmica. Pero, ¿de qué sirve tener una herramienta tan potente si no está nada claro cómo dominarla?</p>
<p>A esta altura, intentar usar <code>metropolis_hastings_log()</code> para muestrear del <em>posterior</em> en los modelos propuestos inicialmente resultaría muy dificultoso. Sería como pasar de manejar un Golcito por las calles del pueblo a subirse a un Fórmula 1 en el medio de un Gran Premio.</p>
<p>Como bien dice el refrán, la práctica hace al maestro. Y quienes conocen de primera mano la verdad de estas palabras son, casualmente, los pilotos de Fórmula 1. No solo acumulan experiencia tras años de competencia en categorías menores, desde el karting hasta la Fórmula 2, sino que también, antes de cada Gran Premio, dan entre 400 y 500 vueltas al circuito… ¡pero en un simulador!</p>
<p>De este modo, en preparación para la aplicación final en este trabajo —nuestro propio Gran Premio— comenzaremos utilizando el algoritmo de Metropolis-Hastings en escenarios simples y controlados, aumentando gradualmente la complejidad. Esto nos permitirá practicar su uso con transformación de variables, en escala logarítmica y en <em>posteriors</em> de múltiples dimensiones. Y al final, como en toda buena carrera, llegará el Gran Premio.</p>
<section id="en-el-simulador-ensayos-con-la-distribución-gamma" class="level3">
<h3 class="anchored" data-anchor-id="en-el-simulador-ensayos-con-la-distribución-gamma">1. En el simulador: ensayos con la distribución Gamma</h3>
<p>El objetivo de esta sección es familiarizarnos con el uso de transformaciones para obtener muestras de distribuciones con soporte acotado. Inicialmente, utilizaremos la función <code>metropolis_hastings()</code> desarrollada en la práctica de la materia, que opera en escala original. Luego, utilizaremos la función <code>metropolis_hastings_log()</code> incluida más arriba, que trabaja en escala logarítmica.</p>
<p>Sea <span class="math inline">\(X \sim \text{Gamma}(\alpha = 3, \beta = 8)\)</span>.</p>
<ol type="1">
<li>Obtenga y grafique la función de densidad de <span class="math inline">\(Y = \log(X)\)</span>.</li>
<li>Utilice Metropolis-Hastings para obtener 10000 muestras de <span class="math inline">\(X\)</span>. Para ello, obtenga muestras de <span class="math inline">\(Y\)</span> utilizando una propuesta normal con <span class="math inline">\(\sigma = 0.2\)</span> y realice la transformación correspondiente para obtener las muestras de <span class="math inline">\(X\)</span>. Para evaluar la bondad del método, calcule el tamaño de muestra efectivo, visualice la trayectoria de la cadena con un <em>traceplot</em> y compare la distribución empírica con la función de densidad teórica utilizando un histograma.</li>
<li>Implemente la función de densidad de <span class="math inline">\(Y\)</span> en escala logarítmica y utilice <code>metropolis_hastings_log()</code> para obtener muestras de <span class="math inline">\(X\)</span>. Calcule el tamaño efectivo de muestra efectivo y compárelo con el obtenido anteriormente. Finalmente, obtenga un histograma de las muestras y compárelo con la densidad empírica y con el histograma obtenido en el punto anterior.</li>
</ol>
</section>
<section id="free-practice-múltiples-dimensiones" class="level3">
<h3 class="anchored" data-anchor-id="free-practice-múltiples-dimensiones">2. <em>Free practice</em>: múltiples dimensiones</h3>
<p>Al cómputo en escala logarítmica y el uso de transformaciones de variables, en esta etapa se le agrega que la distribución objetivo tiene múltiples dimensiones y debe ser obtenida mediante el uso de la regla de Bayes.</p>
<p>Dado el siguiente modelo: <span class="math display">\[
\begin{aligned}
Y_i &amp; \sim \text{Normal}(\mu, \sigma^2) \\
\mu &amp; \sim \text{Normal}(0, 1^2) \\
\sigma &amp; \sim \text{Gamma}(\alpha=2, \beta=2) \\
\end{aligned}
\]</span></p>
<p>con <span class="math inline">\(i = 1, \dots, N\)</span>.</p>
<ol start="4" type="1">
<li>Implemente en R una función que permita calcular la densidad a <em>posteriori</em> en escala logarítmica, sin incluir la constante de normalización. Esta función tendrá 2 parámetros de entrada, uno para el vector de parámetros y otro para el vector de valores observados.</li>
<li>Utilice los valores de <span class="math inline">\(y_i\)</span> en el archivo <code>precalentamiento-mh.txt</code> y la función <code>metropolis_hastings_log()</code> para obtener muestras del <em>posterior</em> de <span class="math inline">\(\boldsymbol{\theta} = \{\mu, \sigma\}\)</span>. Corra dos cadenas de Markov. Calcule el tamaño efectivo de muestra y evalúe mezcla y convergencia de manera gráfica.</li>
</ol>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Evaluación parcial de funciones
</div>
</div>
<div class="callout-body-container callout-body">
<p>En las líneas 41 y 42 del <a href="#lst-mh-log" class="quarto-xref">Listado&nbsp;1</a> se puede ver que la función <code>logp</code> que se pasa a <code>metropolis_hastings_log()</code> debe funcionar correctamente al ser llamada con un único argumento, que es el vector de parámetros. Pero la función que implementamos en el punto 4 tiene 2 argumentos, uno para el vector de parámetros y otro para el vector de datos… ¿cómo hacemos?</p>
<p>La función <code>partial()</code>, de la librería <code>purrr</code>, permite pre-llenar argumentos de una función. Toma como entrada una función, los argumentos con sus valores a pre-llenar, y devuelve una nueva función que hace lo mismo que la función original, pero con valores de argumentos ya especificados.</p>
<p>En nuestro caso, podríamos hacer:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="fu">library</span>(purrr)</span>
<span id="cb1-2"><a href="#cb1-2"></a>logp <span class="ot">&lt;-</span> <span class="fu">partial</span>(log_posterior, <span class="at">y =</span> datos)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Luego, la función <code>logp()</code> puede ser llamada solamente pasando el vector de parámetros. El valor de <code>y</code> será el que se pasó originalmente a la función <code>partial()</code>.</p>
</div>
</div>
</section>
<section id="el-gran-prix-qué-le-decimos-a-brian" class="level3">
<h3 class="anchored" data-anchor-id="el-gran-prix-qué-le-decimos-a-brian">3. El Gran Prix: ¿qué le decimos a Brian?</h3>
<p>A esta altura del partido (o de la carrera mejor dicho) ya estamos ‘retequecontra’ preparados para trabajar con los modelos presentados inicialmente y dar respuesta a la pregunta sobre el efecto del ozono en desarrollo de las ratas de Brian Tarkington. Llegó la hora de realizar el análisis estadístico.</p>
<ol start="6" type="1">
<li>Realice un análisis exploratorio de los datos y describa sus hallazgos.</li>
<li>Para una media y una varianza dada, ¿en qué se diferencia la distribución normal de la distribución T de Student con 3 grados de libertad?</li>
<li>Tanto para el modelo normal como para el basado en la T de Student:
<ol type="i">
<li>Escriba la función de densidad <em>a posteriori</em> en escala logarítmica, sin considerar la constante de normalización. De ser necesario, realice las transformaciones de variables que crea conveniente.</li>
<li>Implemente la función anterior en R.</li>
<li>Use <code>metropolis_hastings_log()</code> para obtener muestras del <em>posterior</em>. Utilice 4 cadenas de 5000 muestras cada una. Evalúe mezcla y convergencia mediante medidas numéricas y gráficas. Visualice las distribuciones <em>a posteriori</em> marginales.</li>
<li>Concluya en términos del problema.</li>
</ol></li>
<li>¿Llega a la misma conclusión con ambos modelos? ¿Por qué?</li>
</ol>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
T de Student no centrada y escalada
</div>
</div>
<div class="callout-body-container callout-body">
<p>La función <code>dt()</code> de R permite evaluar la función de densidad de una distribución T de Student estándar, con media 0 y desvío 1. Para evaluar la función de densidad con media y desvío arbitrario se puede utilizar la siguiente función de R:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>scaled_t_density <span class="ot">&lt;-</span> <span class="cf">function</span>(x, df, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>) {</span>
<span id="cb2-2"><a href="#cb2-2"></a>  <span class="fu">dt</span>((x <span class="sc">-</span> mean) <span class="sc">/</span> sd, df) <span class="sc">/</span> sd</span>
<span id="cb2-3"><a href="#cb2-3"></a>}</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copiado");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copiado");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/estadisticaunr\.github\.io\/estadistica-bayesiana\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../trabajos_practicos/01_tp1.html" class="pagination-link" aria-label="TP 1: ¿La gloria es el dinero?">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">TP 1: ¿La gloria es el dinero?</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../trabajos_practicos/03_tp3.html" class="pagination-link" aria-label="TP 3: Una masacre estadística">
        <span class="nav-page-text">TP 3: Una masacre estadística</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<p>Esta página es hecha con ❤️ y <a href="https://quarto.org/">Quarto</a>.</p>
</div>
  </div>
</footer>




</body></html>