<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="es" xml:lang="es"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.335">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Estadística Bayesiana - Práctica - Unidad 4</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../utils/imgs/favicon.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "Sin resultados",
    "search-matching-documents-text": "documentos encontrados",
    "search-copy-link-title": "Copiar el enlace en la búsqueda",
    "search-hide-matches-text": "Ocultar resultados adicionales",
    "search-more-match-text": "resultado adicional en este documento",
    "search-more-matches-text": "resultados adicionales en este documento",
    "search-clear-button-title": "Borrar",
    "search-detached-cancel-button-title": "Cancelar",
    "search-submit-button-title": "Enviar"
  }
}</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar docked nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Estadística Bayesiana</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../info/programa.html">
 <span class="menu-text">Información</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../teoria/teoria_01.html">
 <span class="menu-text">Teoría</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="../practica/practica_00.html" aria-current="page">
 <span class="menu-text">Práctica</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../trabajos_practicos/descripcion.html">
 <span class="menu-text">Trabajos Prácticos</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/estadisticaunr/estadistica-bayesiana"><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">Práctica - Unidad 4</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation docked overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../practica/practica_00.html" class="sidebar-item-text sidebar-link">Unidad 0</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../practica/practica_01.html" class="sidebar-item-text sidebar-link">Unidad 1</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../practica/practica_02.html" class="sidebar-item-text sidebar-link">Unidad 2</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../practica/practica_03.html" class="sidebar-item-text sidebar-link">Unidad 3</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../practica/practica_04.html" class="sidebar-item-text sidebar-link active">Unidad 4</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../practica/practica_05.html" class="sidebar-item-text sidebar-link">Unidad 5</a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block">Práctica - Unidad 4</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<div>
<p><a href="https://github.com/estadisticaunr/estadistica-bayesiana/raw/pdf/practica/practica_04.pdf">Descargar PDF</a></p>
</div>
<section id="regresión-lineal" class="level2">
<h2 class="anchored" data-anchor-id="regresión-lineal">Regresión lineal</h2>
<ol type="1">
<li><p><strong>Mi primer regresión bayesiana</strong></p>
<p>El conjunto de datos <code>sales</code> contiene los montos semanales de inversión en publicidad y de ingresos de una determinada compañía. Considere el siguiente modelo de regresión lineal simple:</p>
<p><span class="math display">\[
\begin{aligned}
\mu_i &amp;= \beta_0 + \beta_1 \text{publicidad}_i \\
\text{ventas}_i &amp;\sim \text{Normal}(\mu_i, \sigma^2)
\end{aligned}
\]</span></p>
<ol type="i">
<li>Ajuste el modelo utilizando <code>{brms}</code> y sus <em>priors</em> por defecto.</li>
<li>Construya un gráfico que muestre las ventas en función de la inversión en publicidad y superponga la recta de regresión estimada.</li>
</ol></li>
<li><p><strong>Mejorando mi regresión bayesiana</strong></p>
<p>Considere la siguiente versión del modelo del ejercicio anterior que propone distribuciones <em>a priori</em> para los parámetros del modelo: <span class="math display">\[
\begin{aligned}
\mu_i &amp;= \beta_0 + \beta_1 \text{publicidad}_i \\
\text{ventas}_i &amp;\sim \text{Normal}(\mu_i, \sigma^2) \\
\beta_0 &amp;\sim \text{Normal}(\overline{\text{ventas}}, 10) \\
\beta_1 &amp;\sim \text{Normal}(0, 0.5) \\
\sigma^2 &amp;\sim \text{Normal}^+(5)
\end{aligned}
\]</span></p>
<ol type="i">
<li>Ajuste el modelo utilizando <code>{brms}</code> y los <em>priors</em> sugeridos.</li>
<li>Construya un gráfico que muestre las ventas en función de la inversión en publicidad, superponga la recta de regresión estimada, y el intervalo de credibilidad del 95% para la recta de regresión.</li>
</ol></li>
<li><p><strong>Comparando de <code>lm()</code> y <code>brm()</code></strong></p>
<p>Utilice datos simulados para comparar la estimación por mínimos cuadrados con la estimación Bayesiana en modelos de regresión.</p>
<ol type="i">
<li>Simule 100 observaciones del modelo <span class="math inline">\(Y = 2 + 3X + \varepsilon\)</span> donde los valores del predictor <span class="math inline">\(X\)</span> se obtienen de una distribución <span class="math inline">\(\text{Uniforme}(0, 20)\)</span> y los errores son obtenidos de manera independiente de una distribución <span class="math inline">\(\text{Normal}(0, 5^2)\)</span>.</li>
<li>Ajuste el modelo de regresión utilizando <code>lm()</code> y <code>brm()</code> del paquete <code>{brms}</code> utilizando <em>priors</em> por defecto.</li>
<li>Verifique que ambos métodos arrojan resultados similares.</li>
<li>Represente gráficamente los datos y las dos rectas de regresión.</li>
<li>Intente repetir la simulación, pero esta vez cree las condiciones para que ambos enfoques den resultados diferentes. <!-- @Gelman2021 8.8 --></li>
</ol></li>
<li><p><strong>La altura… ¿se hereda?</strong></p>
<p>El conjunto de datos de las alturas (<code>heights</code>) contiene las alturas (en pulgadas) de 5524 pares de madres e hijas registradas en un estudio realizado por Karl Pearson y Alice Lee en 1903.</p>
<ol type="i">
<li>Elabore un gráfico que permita ver la relación entre las alturas de las madres y las hijas. Aplique las técnicas que crea necesaria para obtener una visualización informativa y fidedigna.</li>
<li>¿Por qué es adecuado utilizar un modelo de regresión lineal?</li>
<li>Ajuste el siguiente modelo de regresión lineal utilizando <code>{brms}</code> y <em>priors</em> por defecto:</li>
</ol>
<p><span class="math display">\[
\begin{aligned}
\mu_i &amp;= \beta_0 + \beta_1 \text{altura\_madre}_i \\
\text{altura\_hija}_i &amp;\sim \text{Normal}(\mu_i, \sigma^2)
\end{aligned}
\]</span></p>
<ol type="i">
<li>Calcule la media, el desvío estándar y el intervalo de credibilidad del 95% para los parámetros del modelo utilizando el <em>posterior</em>.</li>
<li>Interprete los coeficientes del modelo.</li>
<li>Superponga la recta de regresión en el gráfico donde se visualiza la relación entre las variables.</li>
<li>Obtenga el <em>posterior</em> del peso medio de una hija cuya madre mide 58 pulgadas. <!-- @Gelman2021 Capitulo 6--></li>
</ol></li>
<li><p><strong>Clima en Australia</strong></p>
<p>El conjunto de datos <code>weather_WU</code> datos climáticos correspondientes a 100 días en dos ciudades de Australia: Uluru y Wollongong. Se intentará predecir la temperatura a las 3 de la tarde, utilizando otras variables.</p>
<p>Considere los siguientes cuatro modelos:</p>
<ul>
<li><span class="math inline">\(m_1\)</span>: <code>temp3pm ~ temp9am</code></li>
<li><span class="math inline">\(m_2\)</span>: <code>temp3pm ~ location</code></li>
<li><span class="math inline">\(m_3\)</span>: <code>temp3pm ~ temp9am + location</code></li>
<li><span class="math inline">\(m_4\)</span>: <code>temp3pm ~ .</code></li>
</ul>
<ol type="i">
<li>Ajuste cada uno de los modelos y construya gráficas para mostrar los parámetros obtenidos</li>
<li>Realice pruebas predictivas <em>a posteriori</em> para comparar los modelos</li>
<li>Compare los <em>ELPD</em> de cada modelo utilizando <em>LOO</em> <!-- Bayes Rules. Capítulo 11. --></li>
</ol>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="imgs/uluru.jpg" class="img-fluid figure-img" style="width:70.0%"></p>
<p></p><figcaption class="figure-caption">Parque Nacional Uluṟu-Kata Tjuṯa en Uluru, Australia. Foto de <a href="https://unsplash.com/snowscat">Snowscat</a> en <a href="https://unsplash.com/photos/8uq1smN9g1w">Unsplash</a></figcaption><p></p>
</figure>
</div>
</div>
</div></li>
<li><p><strong>Pingüinos</strong></p>
<p>Considere el dataset de pingüinos de Palmer (<code>penguins</code>) y los siguientes modelos:</p>
<ul>
<li><span class="math inline">\(m_1\)</span>: <code>body_mass_g ~ flipper_length_mm</code></li>
<li><span class="math inline">\(m_2\)</span>: <code>body_mass_g ~ species</code></li>
<li><span class="math inline">\(m_3\)</span>: <code>body_mass_g ~ flipper_length_mm + species</code></li>
<li><span class="math inline">\(m_4\)</span>: <code>body_mass_g ~ flipper_length_mm + species + flipper_length_mm:species</code></li>
<li><span class="math inline">\(m_5\)</span>: <code>body_mass_g ~ flipper_length_mm + bill_length_mm + bill_depth_mm</code></li>
</ul>
<ol type="i">
<li>Ajuste cada uno de los modelos y construya gráficas para mostrar los parámetros obtenidos</li>
<li>Realice pruebas predictivas <em>a posteriori</em> para comparar los modelos</li>
<li>Compare los <em>ELPD</em> de cada modelo utilizando <em>LOO</em> <!-- Bayes Rules. Capítulo 11. --></li>
</ol></li>
<li><p><strong>De tal palo…</strong></p>
<p>El dataset <code>child_iq</code> contiene información de los resultados de tests de coeficiente intelectual de niños de 3 años, educación de la madre, y edad de la madre cuando dio a luz.</p>
<ol type="i">
<li>Ajuste un modelo de regresión del puntaje del bebé a los 3 años en función de la edad de la madre</li>
<li>Considere ahora un modelo que incluya la educación de la madre</li>
</ol></li>
<li><p><strong>La pinta es lo de menos…</strong></p>
<p>Hamermesh y Parker estudiaron la relación entre los resultados de los estudiantes en un curso y la belleza de los instructores. La determinación de la belleza se hizo a partir de las opiniones de seis estudiantes que no participaron de los cursos y no conocían las notas. Los datos se encuentran en el archivo <code>beauty</code>.</p>
<ol type="i">
<li>Considere un modelo de regresión <code>courseevaluation ~ btystdave</code></li>
<li><strong>To Do</strong>?</li>
</ol></li>
<li><p><strong>Ingresos</strong></p>
<p>El dataset <code>earnings</code> contiene los resultados de la encuesta realizada por Ross sobre Trabajo, Familia y Bienestar.</p>
<ol type="i">
<li>Ajuste un modelo que prediga ingreso en función de altura. ¿Qué transformación sería necesaria para interpretar el intercepto como el ingreso promedio de una persona con altura promedio?</li>
</ol></li>
<li><p><strong>!Kung</strong></p>
<p>Los !Kung son un pueblo que habita en el desierto de Kalahari entre Botsuana, Namibia y Angola. Hablan la lengua !Kung, que se destaca por su amplio uso de consonantes clic (chasquido consonántico). El !K del nombre ǃKung es un sonido como cuando sale un corcho de una botella.</p>
<p>El archivo <code>Howell1</code> contiene datos de un censo parcial realizado por Dobe Howell acerca de la población !Kung.</p>
<p>Considere un modelo de altura en función del peso.</p>
<ol type="i">
<li>Determine e interprete las distribuciones <em>a posteriori</em> de los parámetros</li>
<li>Construya un gráfico de altura en función del peso, incluya las observaciones de los individuos, la recta de regresión MAP, el intervalo del 80% para la media y y el intervalo del 80% para la altura predicha.</li>
<li>Realice predicciones para individuos cuyos pesos son: 46.95, 43.72, 64.78, 32.59 y 54.63. Calcule la altura esperada y el intervalo del 89%.</li>
</ol></li>
<li><p><strong>Zorros urbanos</strong></p>
<p>Considere del conjunto de datos sobre zorros urbanos (<code>foxes</code>). Ajuste tres modelos:</p>
<ul>
<li><span class="math inline">\(m_1\)</span>: <code>weight ~ area</code></li>
<li><span class="math inline">\(m_2\)</span>: <code>weight ~ groupsize</code></li>
<li><span class="math inline">\(m_3\)</span>: <code>weight ~ area + groupsize</code></li>
</ul>
<ol type="i">
<li>Para los modelos <span class="math inline">\(m_1\)</span> y <span class="math inline">\(m_2\)</span>, represente gráficamente los resultados, incluyendo la recta de regresión MAP, su intervalo del 89% y el intervalo de predicción del 89%. ¿Es alguna de las dos variables importantes para predecir la masa de un zorro?</li>
<li>Representar gráficamente las predicciones del modelo para cada predictor, dejando el otro constante en su valor medio. ¿Qué puede decirse sobre la importancia de las variables para predecir la masa de un zorro?</li>
</ol></li>
<li><p><strong>Un <em>prior</em> informativo marca la diferencia</strong></p>
<p>Considere el conjunto de datos sobre belleza y proporción de sexos (<code>sexratio</code>) . Estos datos provienen de un estudio de adolescentes estadounidenses cuyo atractivo en una escala de cinco puntos fue evaluado por entrevistadores en una encuesta cara a cara. Años más tarde, muchos de estos encuestados tuvieron hijos y se registraron ciertos atributos entre los cuales se incluyó el sexo. El objetivo del análisis es comparar la proporción de sexos de los hijos según la belleza de los padres. Para ello considere el siguiente modelo de regresión:</p>
<p><span class="math display">\[
\begin{aligned}
\mu_i &amp;= \beta_0 + \beta_1 \text{belleza}_i \\
\text{pf}_i &amp;\sim \text{Normal}(\mu_i, \sigma^2)
\end{aligned}
\]</span></p>
<p>Donde <span class="math inline">\(\text{pf}\)</span> representa la proporción de bebés de sexo femenino y <span class="math inline">\(\text{belleza}\)</span> representa el grupo de belleza de los padres.</p>
<ol type="i">
<li>Ajuste el modelo utilizando mínimos cuadrados.</li>
<li>Ajuste el modelo con <code>brm()</code> y sus <em>priors</em> por defecto.</li>
<li>Compare el ajuste de ambos modelos.</li>
<li>Explore los <em>priors</em> utilizados por <code>{brms}</code> y la distribución predictiva <em>a priori</em>. ¿Qué puede concluir?</li>
<li>Proponga distribuciones <em>a priori</em> informativas.</li>
<li>Ajuste el modelo utilizando <code>brm()</code> y los <em>priors</em> informativos.</li>
<li>Compare el resultado con los obtenidos anteriormente y concluya.</li>
</ol></li>
<li><p><strong>¡A la pesca de <em>priors</em>!</strong></p>
<p>El conjunto de datos <code>fish-market</code> contiene mediciones morfológicas realizadas sobre pescados de diferentes especies. El objetivo es construir un modelo de regresión lineal que permita predecir el peso de los pescados en base a sus otros atributos.</p>
<p>Uno de los modelos propuestos es el siguiente:</p>
<p><span class="math display">\[
\begin{aligned}
\log(\text{Weight}_i) &amp;\sim \text{Normal}(\mu_i, \sigma) \\
\mu_i  &amp;= \beta_{0, j[i]} + \beta_{1, j[i]} \log(\text{Length1}_i)
\end{aligned}
\]</span></p>
<p><span class="math inline">\(\text{Weight}_i\)</span> es el peso del i-ésimo pescado en gramos y <span class="math inline">\(\text{Length1}_i\)</span> es la longitud del i-ésimo pescado en centímetros. La letra <span class="math inline">\(j\)</span> indexa las especies de los pescados. Por lo tanto, en este modelo cada especie tiene su propio intercepto y pendiente.</p>
<ol type="i">
<li>Implemente el modelo utilizando <code>{brms}</code> y los siguientes <em>priors</em> no informativos <span class="math display">\[
\begin{aligned}
\beta_{0, j[i]} &amp;\sim \text{Normal}(0, 10) \\
\beta_{1, j[i]} &amp;\sim \text{Normal}(0, 5)
\end{aligned}
\]</span></li>
<li>Obtenga y visualice la distribución predictiva a <em>priori</em>.</li>
<li>Elabore un gráfico y describa la función de densidad <em>a priori</em> de los parámetros <span class="math inline">\(\beta_{0, j[i]}\)</span> y <span class="math inline">\(\beta_{1, j[i]}\)</span>.</li>
<li>Proponga <em>priors</em> más adecuados en base a la interpretación de los parámetros del modelo y la información que tenga del problema.</li>
<li>Nuevamente, obtenga y visualice la distribución predictiva a <em>priori</em> y compare con el resultado obtenido anteriormente.</li>
<li>Ajuste el modelo, obtenga la distribución predictiva <em>a posteriori</em> y grafíquela.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="imgs/especies_pescados.png" class="img-fluid figure-img" style="width:70.0%"></p>
<p></p><figcaption class="figure-caption">Especies de peces de todas variedades y tamaños.</figcaption><p></p>
</figure>
</div>
</div>
</div></li>
<li><p><strong>En búsqueda del modelo adecuado</strong></p>
<p>Continuando con los datos del ejercicio anterior, El objetivo es construir un modelo de regresión lineal que permita predecir el peso de los pescados en base a sus otros atributos.</p>
<p>Considere los siguientes modelos</p>
<ul>
<li><span class="math inline">\(m_1\)</span>: <code>log(Weight) ~ 0 + Species</code></li>
<li><span class="math inline">\(m_2\)</span>: <code>log(Weight) ~ 0 + Species + log(Length1)</code></li>
<li><span class="math inline">\(m_3\)</span>: <code>log(Weight) ~ 0 + Species + log(Length1):Species</code></li>
<li><span class="math inline">\(m_4\)</span>: <code>log(Weight) ~ 0 + Species + log(Length1):Species + log(Height)</code></li>
<li><span class="math inline">\(m_5\)</span>: <code>log(Weight) ~ 0 + Species + log(Length1):Species + log(Height):Species</code></li>
</ul>
<ol type="i">
<li>Ajuste cada uno de los modelos.</li>
<li>Estime el <em>ELPD</em> de cada modelo utilizando <em>LOO</em> y seleccione el modelo más adecuado de acuerdo a este criterio.</li>
<li>Explique el resultado.</li>
</ol></li>
<li><p><strong>Comparación de modelos</strong></p>
<p>Se recopilaron datos (<code>mesquite</code>) con el fin de desarrollar un método para estimar la producción total (biomasa) de hojas de mesquite utilizando parámetros fácilmente medibles de la planta, antes de que se realice la cosecha real. Se tomaron dos conjuntos separados de mediciones, uno en un grupo de 26 arbustos de mesquite y otro en un grupo diferente de 20 arbustos de mesquite medidos en un momento diferente del año. Todos los datos se obtuvieron en la misma ubicación geográfica, pero ninguno constituyó una muestra estrictamente aleatoria. La variable de resultado es el peso total (en gramos) de material fotosintético obtenido de la cosecha real del arbusto. Las variables de entrada son:</p>
<table class="table">
<colgroup>
<col style="width: 17%">
<col style="width: 82%">
</colgroup>
<thead>
<tr class="header">
<th><strong>Nombre</strong></th>
<th><strong>Descripción</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>diam1</code></td>
<td>Diámetro de la copa medido a lo largo del eje más largo del arbusto (metros)</td>
</tr>
<tr class="even">
<td><code>diam2</code></td>
<td>Diámetro de la copa medido a lo largo del eje más corto (metros)</td>
</tr>
<tr class="odd">
<td><code>canopy_height</code></td>
<td>Altura de la copa</td>
</tr>
<tr class="even">
<td><code>total_height</code></td>
<td>Altura total del arbusto</td>
</tr>
<tr class="odd">
<td><code>density</code></td>
<td>Número de tallos primarios por planta</td>
</tr>
<tr class="even">
<td><code>group</code></td>
<td>Grupo de mediciones (0 para el primer grupo, 1 para el segundo)</td>
</tr>
</tbody>
</table>
<ol type="i">
<li>Realice un análisis exploratorio de los datos.</li>
<li>Ajuste el modelo <code>weight ~ diam1 + diam2 + canopy_height + total_height + density + group</code>.</li>
<li>Explore y describa el <em>posterior</em>.</li>
<li>Estime <em>ELPD</em> mediante <em>PSIS-CV</em> con la función <code>loo()</code>, analice los valores de las estimaciones del parámetro <span class="math inline">\(k\)</span> de la distribución generalizada de Pareto y otros valores de la salida que crea relevant, ¿qué puede concluir?</li>
<li>Estime ELPD mediante <em>K-fold cross validation</em> con <span class="math inline">\(K=10\)</span>. Compare la estimación con el resultado obtenido mediante <em>PSIS-CV</em> y concluya.</li>
<li>Ajuste el modelo transformando todas las variables numéricas con la función logarítmica. ¿Cómo afecta esta transformación la interpretación de los coeficientes?</li>
<li>Estime <em>ELPD</em> mediante <em>PSIS-CV</em> con la función <code>loo()</code>. Concluya acerca de la estabilidad del cómputo. ¿Es posible comparar la la estimación con la obtenida en el inciso iv? ¿Por qué?</li>
<li>Con ambos modelos, obtenga y grafique la distribución predictiva <em>a posteriori</em> comparándola con los datos observados ¿Cuál de los modelos representa mejor a los datos?</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="imgs/mesquite.png" class="img-fluid figure-img" style="width:70.0%"></p>
<p></p><figcaption class="figure-caption">Un árbol de mesquite.<br>Foto de Sergei Bogomyakov, <a href="https://nationalgeographicla.com/fotografo/alamy-stock-photo">Alamy Stock Photo</a>.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<!-- @Gelman2021 Capitulo 12-->
<!-- https://avehtari.github.io/ROS-Examples/Mesquite/mesquite.html --></li>
<li><p><strong>Secundarios en Portugal</strong></p>
<p>Se cuenta con un conjunto de datos sobre 343 estudiantes de secundaria de Portugal (<code>portugal</code>) y se desea predecir la calificación final en matemáticas del último año en base a un gran número de predictores potencialmente relevantes.</p>
<p>El listado de variables se compone por: escuela del estudiante, sexo del estudiante, edad del estudiante, tipo de domicilio del estudiante, tamaño de la familia, estado de convivencia de los padres, educación de la madre, educación del padre, tiempo de viaje del hogar a la escuela, tiempo de estudio semanal, número de fracasos escolares pasados, apoyo educativo adicional, clases pagadas adicionales dentro de la materia del curso, actividades extracurriculares, si el estudiante asistió a una guardería, si el estudiante desea cursar estudios superiores, acceso a Internet en el hogar, si el estudiante tiene una relación romántica, calidad de las relaciones familiares, tiempo libre después de la escuela, si el estudiante sale con amigos, consumo de alcohol entre semana, consumo de alcohol los fines de semana, estado de salud actual y número de ausencias escolares.</p>
<p><strong>Priors débilmente informativos</strong></p>
<ol type="i">
<li><p>Ajuste un modelo de regresión lineal utilizando todos los predictores luego de estandarizarlos y con los siguientes <em>priors</em> <span class="math display">\[
\begin{aligned}
\beta_k &amp;\sim \text{Normal}(0, 2.5) \\
\sigma  &amp;\sim \text{Exponential}(1 / \text{std}(y))
\end{aligned}
\]</span></p></li>
<li><p>Elabore un gráfico para visualizar los <em>posteriors</em> marginales y compárelos. ¿Qué puede concluir acerca de su incertidumbre?</p></li>
<li><p>Calcule y compare la mediana del <span class="math inline">\(R^2\)</span> bayesiano y del <span class="math inline">\(R^2\)</span> calculado mediante <em>LOO</em> ¿Qué conclusión puede extraer de esta comparación?</p></li>
<li><p>¿Cuál es el número efectivo de parámetros según <em>LOO</em>? ¿Qué indica?</p></li>
<li><p>Obtenga muestras del <em>prior</em> y del <em>posterior</em> del <span class="math inline">\(R^2\)</span> bayesiano, compárelos utilizando una visualización y concluya considerando la elección de los <em>priors</em> débilmente informativos sobre <span class="math inline">\(\beta_k\)</span> y <span class="math inline">\(\sigma\)</span>.</p></li>
</ol>
<p><strong>Priors alternativos (I)</strong></p>
<p>Si se asume que muchos predictores pueden tener poca relevancia, se pueden escalar los <em>priors</em> independientes para que la suma de la varianza de los <em>priors</em> se encuentre alrededor de un valor razonable. En este caso, se cuenta con 26 predictores y se podría suponer que la proporción de la varianza explicada por los predictores está alrededor de 0.3. Entonces, un enfoque simple consiste en asignar <em>priors</em> independientes a los coeficientes de regresión con media 0 y desviación estándar <span class="math inline">\(\sqrt{0.3/26}\text{sd}(y)\)</span> y un <em>prior</em> exponencial con media <span class="math inline">\(\sqrt{0.7}\text{sd}(y)\)</span> para <span class="math inline">\(\sigma\)</span>.</p>
<ol type="i">
<li>Ajuste el modelo nuevamente utilizando los siguientes priors <span class="math display">\[
\begin{aligned}
\beta_k &amp;\sim \text{Normal}(0, \sqrt{\frac{0.3}{26}}\text{sd}(y)) \\
\sigma  &amp;\sim \text{Exponential}(1 / \sqrt{0.7}\text{sd}(y))
\end{aligned}
\]</span></li>
<li>Explore la distribución <em>a priori</em> sobre <span class="math inline">\(R^2\)</span> y compárela con la distribución obtenida con los <em>priors</em> débilmente informativos.</li>
<li>Calcule <em>ELPD</em> mediante <em>LOO</em> y compare este modelo con el anterior.</li>
<li>Elabore un gráfico para visualizar los <em>posteriors</em> marginales. Compare este resultado con el obtenido con los <em>priors</em> débilmente informativos.</li>
</ol>
<p><strong>Priors alternativos (II)</strong></p>
<p>Otra alternativa es asumir que solo algunos de los predictores tienen alta relevancia y que el resto de los predictores tienen una relevancia insignificante. Una posibilidad para modelar bajo este supuesto es el <em>horseshoe prior</em> regularizado<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>. Este <em>prior</em> utiliza distribuciones normales independientes con media 0 y varianza <span class="math inline">\(\tau^2\lambda_k^2\)</span> para los coeficientes de regresión <span class="math inline">\(\beta_k\)</span> y se describe a continuación:</p>
<p><span class="math display">\[
\begin{aligned}
\beta_k   &amp;\sim \text{Normal}(0, \tau^2\tilde{\lambda}_k^2) \\
\tilde{\lambda}_k^2 &amp;= \frac{c^2\lambda_k^2}{c^2 + \tau^2\lambda_k^2} \\
c &amp; = \sqrt{c'} \text{SS} \\
c' &amp;\sim \text{InvGamma}(0.5 \cdot SDF, 0.5 \cdot SDF) \\
\lambda_k &amp;\sim \text{StudentT}^+(\text{df} = 1, \mu = 0, \sigma = 1 ) \\
\tau      &amp;\sim \text{StudentT}^+(\text{df} = 1, \mu = 0, \sigma = \text{GS})
\end{aligned}
\]</span></p>
<p>con <span class="math display">\[
\begin{aligned}
\text{GS} = \frac{p_0}{p - p_0} \frac{\sigma}{\sqrt{n}} \\
\text{SS} = \sqrt{\frac{0.3}{p_0}} \text{sd}(y) \\
\text{SDF} = 4
\end{aligned}
\]</span></p>
<p>donde <span class="math inline">\(\text{GS}\)</span>, <span class="math inline">\(\text{SS}\)</span> y <span class="math inline">\(\text{SDF}\)</span> representan <em>global scale</em>, <em>slab scale</em> y <em>slab degrees of freedom</em>, respectivamente. Además, <span class="math inline">\(p\)</span> representa la cantidad de predictores, 26, y <span class="math inline">\(p_0\)</span> la cantidad de predictores que se espera que sean relevantes.</p>
<p>Intuitivamente, el parámetro global <span class="math inline">\(\tau\)</span> empuja todos los <span class="math inline">\(\beta_k\)</span> hacia el 0, mientras que los parámetros locales <span class="math inline">\(\lambda_k\)</span> contribuyen a que algunos de los <span class="math inline">\(\beta_k\)</span> escapen del 0.</p>
<ol type="i">
<li>Utilice <span class="math inline">\(p_0 = 6\)</span> para ajustar el modelo con todos los predictores y grafique y analice los <em>posteriors</em> marginales.</li>
<li>Compare este modelo con los ajustados anteriormente en base a sus <em>ELPD</em> estimados con <em>LOO</em> y concluya.</li>
</ol>
<p><strong>Priors débilmente informativos con menos predictores</strong></p>
<p>Ajuste el modelo de regresión con un subconjunto de predictores que crea conveniente y los <em>priors</em> débilmente informativos que se utilizaron inicialmente.</p>
<ol type="i">
<li>Visualice los <em>posteriors</em> marginales.</li>
<li>Nuevamente, calcule y compare la mediana del <span class="math inline">\(R^2\)</span> bayesiano y del <span class="math inline">\(R^2\)</span> calculado mediante.</li>
<li>Compare este modelo con el ajustado anteriormente en base a sus <em>ELPD</em> estimados con <em>LOO</em> y concluya sobre la capacidad predictiva de este modelo.</li>
</ol>
<!-- Nota: A la hora de pasar `scale_global` a `horseshoe` de `brms` no hay que incluir
`sigma` porque eso pasa internamente (mostrar como buscar la ayuda online) -->
<!-- @Gelman2021 Capitulo 12 --></li>
</ol>
<!-- 
1.  **Ejercicio donde haya sobre-ajuste**

    Idea: Utilizar priors estrechos para prevenir sobre-ajuste?


Lo que falta:

* Eleccion de distribuciones a priori
    * Priors de regularizacion (e.g. cuando hay muchos predictores numéricos)
* Sobreajuste y subajuste
* Deberiamos ver como escribimos lo de "estimar elpd con loo" porque es ambiguo.
  La documentacion de la funcion dice
  "compute PSIS-LOO CV, efficient approximate leave-one-out (LOO) cross-validation for 
  Bayesian models using Pareto smoothed importance sampling (PSIS)
  
  Returns:
  A matrix with two columns (Estimate, SE) and three rows (elpd_loo, p_loo, looic). 
  This contains point estimates and standard errors of the expected log pointwise 
  predictive density (elpd_loo), the effective number of parameters (p_loo) and the 
  LOO information criterion looic (which is just -2 * elpd_loo, i.e., converted to deviance scale).
  "
-->
<!-- 
Unidad 4: Modelos Lineales
Modelos lineales. Elección de distribuciones a priori. Regularización. Diagnóstico de modelos. Predicciones basadas en distribuciones de probabilidad. Pruebas predictivas a priori y a posteriori. Densidad predictiva a posteriori logarítmica evaluada punto a punto (lppd). Deviance. Criterios de información: AIC, BIC, WAIC. Validacion cruzada. Sobreajuste y subajuste. Validación cruzada utilizando muestreo por importancia mediante suavizado Pareto (PSIS-CV). 
-->



</section>


<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography"><h2 class="anchored quarto-appendix-heading">Referencias</h2><div id="refs" class="references csl-bib-body hanging-indent" role="doc-bibliography">
<div id="ref-Downey2021" class="csl-entry" role="doc-biblioentry">
Downey, Allen B. 2021. <em>Think Bayes: Bayesian Statistics in Python</em>. 2nd edition. O’Reilly Media. <a href="http://allendowney.github.io/ThinkBayes2/">http://allendowney.github.io/ThinkBayes2/</a>.
</div>
<div id="ref-Gelman2021" class="csl-entry" role="doc-biblioentry">
Gelman, Andrew, Jennifer Hill, y Aki Vehtari. 2021. <em>Regression and Other Stories</em>. 1st edition. Cambridge University Press. <a href="https://users.aalto.fi/~ave/ROS.pdf">https://users.aalto.fi/~ave/ROS.pdf</a>.
</div>
<div id="ref-Johnson2021" class="csl-entry" role="doc-biblioentry">
Johnson, Alicia A., Miles Q. Ott, y Mine Dogucu. 2022. <em>Bayes Rules! An Introduction to Bayesian Modeling</em>. 1st edition. Chapman; Hall/CRC. <a href="https://www.bayesrulesbook.com/">https://www.bayesrulesbook.com/</a>.
</div>
<div id="ref-Martin2021" class="csl-entry" role="doc-biblioentry">
Martin, Osvaldo A., Ravin Kumar, y Junpeng Lao. 2021. <em>Bayesian Modeling and Computation in Python</em>. 1st edition. Chapman; Hall/CRC.
</div>
</div></section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Notas</h2>

<ol>
<li id="fn1"><p>El nombre <em>horseshoe</em> (herradura) no se relaciona con la forma de la función de densidad en sí, sino con la forma del <em>prior</em> implícito para los coeficientes de <em>shrinkage</em> (contracción) aplicados a cada parámetro.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copiado");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copiado");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-right">Esta página es hecha con ❤️ y <a href="https://quarto.org/">Quarto</a>.</div>
  </div>
</footer>



</body></html>